openapi: 3.0.0
info:
  title: ClearCompany-Paylocity Integration API
  description: API documentation for the integration between ClearCompany ATS and Paylocity Headcount Planning
  version: 1.0.0
  contact:
    name: API Support
servers:
  - url: https://0xqw55anre.execute-api.us-east-1.amazonaws.com/development

components:
  securitySchemes:
    ApiKeyAuth:
      type: apiKey
      in: header
      name: x-api-key
  schemas:
    Requisition:
      type: object
      required:
        - title
        - description
        - department
        - location
        - employmentType
        - status
      properties:
        id:
          type: string
          readOnly: true
        title:
          type: string
        description:
          type: string
        department:
          type: string
        location:
          type: string
        employmentType:
          type: string
        status:
          type: string
        salary:
          type: object
          properties:
            min:
              type: number
            max:
              type: number
            currency:
              type: string
        requirements:
          type: array
          items:
            type: string
        benefits:
          type: array
          items:
            type: string
        customFields:
          type: object
          additionalProperties: true
        createdAt:
          type: string
          format: date-time
          readOnly: true
        updatedAt:
          type: string
          format: date-time
          readOnly: true

    HeadcountPlan:
      type: object
      required:
        - requisitionId
        - department
        - position
        - startDate
        - status
        - headcount
        - budget
      properties:
        id:
          type: string
          readOnly: true
        requisitionId:
          type: string
        department:
          type: string
        position:
          type: string
        startDate:
          type: string
          format: date
        endDate:
          type: string
          format: date
        status:
          type: string
        headcount:
          type: integer
          minimum: 1
        budget:
          type: number
          minimum: 0
        customFields:
          type: object
          additionalProperties: true
        createdAt:
          type: string
          format: date-time
          readOnly: true
        updatedAt:
          type: string
          format: date-time
          readOnly: true

    WebhookEvent:
      type: object
      required:
        - type
        - entityId
        - action
        - data
      properties:
        type:
          type: string
          enum: [requisition, candidate]
        entityId:
          type: string
        action:
          type: string
        data:
          type: object
          additionalProperties: true

    ApiResponse:
      type: object
      properties:
        data:
          type: object
        error:
          type: object
          properties:
            message:
              type: string
            code:
              type: string

  examples:
    CreateRequisitionRequest:
      summary: Example requisition create
      value:
        title: Senior Software Engineer
        description: We are seeking an experienced Senior Software Engineer to join our growing team. The ideal candidate will have strong experience in cloud technologies and distributed systems.
        department: Engineering
        location: Remote - US
        employmentType: Full-time
        salary:
          min: 120000
          max: 180000
          currency: USD
        requirements:
          - 8+ years of software development experience
          - Strong experience with AWS or similar cloud platforms
          - Expertise in Node.js/TypeScript
          - Experience with serverless architectures
        benefits:
          - Competitive salary
          - Health insurance
          - 401(k) matching
          - Unlimited PTO
        status: Open
    RequisitionStatusWebhook:
      summary: Requisition status updated
      value:
        type: requisition
        entityId: req-local-stub
        action: status_updated
        data:
          status: approved
    CandidateStatusWebhook:
      summary: Candidate hired update
      value:
        type: candidate
        entityId: candidate-123
        action: status_updated
        data:
          status: hired
          requisitionId: req-local-stub

security:
  - ApiKeyAuth: []

paths:
  /health:
    get:
      summary: Health check
      operationId: health
      tags:
        - System
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: ok
                  timestamp:
                    type: string
                    format: date-time

  /api/requisitions:
    post:
      summary: Create a new requisition
      operationId: createRequisition
      tags:
        - Requisitions
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Requisition'
            examples:
              default:
                $ref: '#/components/examples/CreateRequisitionRequest'
      responses:
        '201':
          description: Requisition created successfully (wrapped)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /api/requisitions/{id}:
    put:
      summary: Update an existing requisition
      operationId: updateRequisition
      tags:
        - Requisitions
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Requisition'
      responses:
        '200':
          description: Requisition updated successfully (wrapped)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '404':
          description: Requisition not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /api/webhooks/requisition-status:
    post:
      summary: Handle requisition status webhook
      operationId: handleRequisitionStatusWebhook
      tags:
        - Webhooks
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WebhookEvent'
            examples:
              default:
                $ref: '#/components/examples/RequisitionStatusWebhook'
      responses:
        '200':
          description: Webhook processed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
        '400':
          description: Invalid webhook payload
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /api/webhooks/candidate-status:
    post:
      summary: Handle candidate status webhook
      operationId: handleCandidateStatusWebhook
      tags:
        - Webhooks
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WebhookEvent'
            examples:
              default:
                $ref: '#/components/examples/CandidateStatusWebhook'
      responses:
        '200':
          description: Webhook processed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
        '400':
          description: Invalid webhook payload
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
